<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--    <link href="bootstrap-5.1.3-dist/css/bootstrap.css" rel="stylesheet">-->
    <!--    <script src="bootstrap-5.1.3-dist/jquery-3.6.0.min.js"></script>-->
    <!--    <script src="bootstrap-5.1.3-dist/js/bootstrap.js"></script>-->

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/moment.js/2.24.0/moment-with-locales.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    <script>
        $(document).ready(function () {
            let picker1 = $('#datetimepicker2').datetimepicker({
                time
                format: 'YYYY-MM-DD hh:mm',
                locale: moment.locale('zh-cn')
            });
            $("#setAlert").click(function () {
                console.warn($("#dateText").val());
                $.post("setAlert",{
                    "taskid":$("#setAlert").parent().parent().parent().attr("taskid"),
                    "usrid": $("#setAlert").parent().parent().parent().attr("usrid"),
                    "alertTime":$("#dateText").val()
                })
            })
            // picker1.on('dp.change', function (e) {
            //     picker1.data('DateTimePicker').minDate(e.date);
            // });
            // //动态设置最大值
            // picker1.on('dp.change', function (e) {
            //     picker1.data('DateTimePicker').maxDate(e.date);
            // });
        });
    </script>
    <script>
        window.onload = function myf() {
            function sideBar() {
                $(".text").click(function () {
                    $("#sidebar").attr("taskid",$(this).parent().attr("taskid"));
                    $("#sidebar").attr("usrid",$(this).parent().attr("usrid"));
                    $("#sidebar").attr("isimportant",$(this).parent().attr("isimportant"));
                    $("#sidebar").attr("isdaily",$(this).parent().attr("isdaily"));
                    $("#sidebar").attr("alerttime",$(this).parent().attr("alerttime"));
                    if($("#sidebar").attr("isimportant")==="0"){
                        $("#is-important").attr("class","fa fa-heart-o");
                    }else {
                        $("#is-important").attr("class","fa fa-heart");
                    }
                    $("#sidebar").show();

                    $("#sidebar-text").text(this.innerText);
                });
                $(".text").dblclick(function () {

                    $("#sidebar").hide();
                });}
            $("#is-important").click(function () {

                if ($("#is-important").attr("class")=="fa fa-heart-o"){
                    console.log("click it1");
                    $("#is-important").attr("class","fa fa-heart");
                    const ss =$("#is-important").parent().parent().parent().attr("taskid");
                    $("li[taskid="+ss+"]").attr("isimportant","1");
                    $("#is-important").parent().parent().parent().attr("isimportant","1");
                    $("li[taskid="+ss+"]").attr("style","font-weight: bold");
                }else {
                    console.log("click it2");
                    $("#is-important").attr("class","fa fa-heart-o");
                    const ss =$("#is-important").parent().parent().parent().attr("taskid");
                    $("li[taskid="+ss+"]").attr("isimportant","0");
                    $("#is-important").parent().parent().parent().attr("isimportant","0");
                    $("li[taskid="+ss+"]").attr("style","font-weight: normal");
                }
                $.post("isImportant",{
                    "taskid": $("#is-important").parent().parent().parent().attr("taskid"),
                    "usrid":$("#is-important").parent().parent().parent().attr("usrid"),
                    "isImportant": $("#is-important").parent().parent().parent().attr("isimportant")
                })
            });
            $("#is-daily").click(function () {
                if ($("#is-daily").attr("class")=="fa fa-calendar-minus-o"){
                    $("#is-daily").attr("class","fa fa-calendar-check-o");
                }else {
                    $("#is-daily").attr("class","fa fa-calendar-minus-o");
                }
            });
            $("#sidebar").hide();
            if(document.cookie==null||document.cookie==""){
                $.get("",{

                });
            }
            const newTodoBtn = document.querySelector("#data-new-list-btn");
            const todoInput = document.querySelector("#data-new-list-input");
            const delBtm = document.querySelectorAll(".del-btn");
            const container = document.querySelector("#task");
            function decodeUtf8(bytes) {
                var encoded = "";
                for (var i = 0; i < bytes.length; i++) {
                    encoded += '%' + bytes[i].toString(16);
                }
                return decodeURIComponent(encoded);
            }
            let x = decodeURIComponent(document.cookie.split("=")[1]);
            console.log(x);
            var y = x.split("&");
            y.pop();
            for(var i=0; i<y.length; i++) {
                console.log(y);
                // y[i]+="}";
                y[i] = JSON.parse(y[i]);
                console.log(y[i]["task"]);
                if (y[i]["task"] != null && y[i]["task"]!= ""&&y[i]["isComplete"]!= "1"){
                    const newLi = document.createElement("li");
                    newLi.setAttribute("isComplete",y[i]["isComplete"]);
                    newLi.setAttribute("isDaily",y[i]["isDaily"]);
                    newLi.setAttribute("isImportant",y[i]["isImportant"]);
                    newLi.setAttribute("task",y[i]["task"]);
                    newLi.setAttribute("taskId",y[i]["taskId"]);
                    newLi.setAttribute("usrId",y[i]["usrId"]);
                    newLi.setAttribute("alertTime",y[i]["alertTime"]);
                    newLi.classList.add("listed-tasks");
                    newLi.style.display = "none";
                    const newCheckBox = document.createElement("input");
                    newCheckBox.type="checkbox";
                    newCheckBox.classList.add("check-box");
                    newLi.appendChild(newCheckBox);
                    const newSpan = document.createElement("span");
                    newSpan.classList.add("text");
                    newSpan.innerText = " " + y[i]["task"] + " ";
                    if(y[i]["isImportant"]=="1"){
                        newSpan.style.fontWeight = "bold";
                    }
                    newLi.appendChild(newSpan);
                    const newBtn = document.createElement("button");
                    newBtn.classList.add("btn-xs");
                    newBtn.classList.add("del-btn");
                    newBtn.style.fontSize = "8px";
                    newBtn.style.color = "red";
                    const newDel = document.createElement("i");
                    newDel.classList.add("fa");
                    newDel.classList.add("fa-close");
                    newBtn.appendChild(newDel);
                    newLi.appendChild(newBtn);
                    console.log(newLi);
                    document.getElementById("task").appendChild(newLi);
                    $(".listed-tasks").fadeIn("slow");
                }
            }
            document.addEventListener("keyup", e => {
                if(e.code === "Slash") {
                    todoInput.focus();
                }
            })
            $("input").keypress(function () {
                if (event.keyCode=="13") {
                    let todoVal = todoInput.value;
                    if (todoInput.value && todoInput.value != " " && todoInput.value != "  " && todoInput.value != "   " && todoInput.value != "    "
                        && todoInput.value != "     " && todoInput.value != "      " && todoInput.value != "       ") {
                        const newLi = document.createElement("li");
                        newLi.classList.add("listed-tasks");
                        newLi.style.display = "none";
                        //在新建li标签后通过newTask get 获取taskId写入attr
                        var xmlhttp;
                        if (window.XMLHttpRequest) {
                            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                            xmlhttp = new XMLHttpRequest();
                        } else {
                            // IE6, IE5 浏览器执行代码
                            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                        }
                        xmlhttp.open("GET", "/newTask", true);
                        xmlhttp.send();
                        xmlhttp.onreadystatechange = function () {
                            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                                newLi.setAttribute("isComplete", "0");
                                newLi.setAttribute("isDaily", "0");
                                newLi.setAttribute("isImportant", "0");
                                newLi.setAttribute("task", todoVal);
                                newLi.setAttribute("alerttime",null);
                                todoVal = "";
                                newLi.setAttribute("taskId", xmlhttp.getResponseHeader("TaskId").toString());
                                newLi.setAttribute("usrId", xmlhttp.getResponseHeader("UsrId").toString());
                            }
                        }

                        const newCheckBox = document.createElement("input");
                        newCheckBox.type = "checkbox";
                        newCheckBox.classList.add("check-box");
                        newLi.appendChild(newCheckBox);
                        const newSpan = document.createElement("span");
                        newSpan.classList.add("text");
                        newSpan.innerText = " " + todoInput.value + " ";
                        newLi.appendChild(newSpan);
                        const newBtn = document.createElement("button");
                        newBtn.classList.add("btn-xs");
                        newBtn.classList.add("del-btn");
                        newBtn.style.fontSize = "8px";
                        newBtn.style.color = "red";
                        const newDel = document.createElement("i");
                        newDel.classList.add("fa");
                        newDel.classList.add("fa-close");
                        newBtn.appendChild(newDel);
                        newLi.appendChild(newBtn);
                        console.log(newLi);
                        document.getElementById("task").appendChild(newLi);
                        $(".listed-tasks").fadeIn("slow");
                        $.post("", {
                            taskContent: todoInput.value,
                            isImportant: null,
                            TaskId: null
                        });
                        todoInput.value = "";
                        todoInput.focus();
                        sideBar();
                        checkBox();
                    }
                };
            })

            newTodoBtn.addEventListener("click",evt => {
                let todoVal = todoInput.value;
                if(todoInput.value&&todoInput.value!= " "&&todoInput.value!= "  "&&todoInput.value!= "   "&&todoInput.value!= "    "
                    &&todoInput.value!= "     "&&todoInput.value!= "      "&&todoInput.value!= "       "){
                    const newLi = document.createElement("li");
                    newLi.classList.add("listed-tasks");
                    newLi.style.display = "none";
                    //在新建li标签后通过newTask get 获取taskId写入attr
                    var xmlhttp;
                    if (window.XMLHttpRequest) {
                        //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                        xmlhttp = new XMLHttpRequest();
                    } else {
                        // IE6, IE5 浏览器执行代码
                        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }
                    xmlhttp.open("GET", "/newTask", true);
                    xmlhttp.send();
                    xmlhttp.onreadystatechange = function () {
                        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                            newLi.setAttribute("isComplete", "0");
                            newLi.setAttribute("isDaily", "0");
                            newLi.setAttribute("isImportant", "0");
                            newLi.setAttribute("task", todoVal);
                            todoVal = "";
                            newLi.setAttribute("taskId", xmlhttp.getResponseHeader("TaskId").toString());
                            newLi.setAttribute("usrId", xmlhttp.getResponseHeader("UsrId").toString());
                        }
                    }

                    const newCheckBox = document.createElement("input");
                    newCheckBox.type = "checkbox";
                    newCheckBox.classList.add("check-box");
                    newLi.appendChild(newCheckBox);
                    const newSpan = document.createElement("span");
                    newSpan.classList.add("text");
                    newSpan.innerText = " " + todoInput.value + " ";
                    newLi.appendChild(newSpan);
                    const newBtn = document.createElement("button");
                    newBtn.classList.add("btn-xs");
                    newBtn.classList.add("del-btn");
                    newBtn.style.fontSize = "8px";
                    newBtn.style.color = "red";
                    const newDel = document.createElement("i");
                    newDel.classList.add("fa");
                    newDel.classList.add("fa-close");
                    newBtn.appendChild(newDel);
                    newLi.appendChild(newBtn);
                    document.getElementById("task").appendChild(newLi);
                    $(".listed-tasks").fadeIn("slow");
                    $.post("", {
                        taskContent: todoInput.value,
                        isImportant: null,
                        TaskId: null
                    });
                    todoInput.value = "";
                    todoInput.focus();
                    sideBar();
                    checkBox();
                }
            });
            container.addEventListener("click", evt => {
                const item = evt.target;
                if (item.className === "btn-xs del-btn") {
                    const todo = item.parentElement;
                    $.post("delete",{
                       "usrid":todo.getAttribute("usrid"),
                        "taskid":todo.getAttribute("taskid")
                    });
                    if($("#sidebar").attr("taskid")==todo.getAttribute("taskid")&&$("#sidebar").attr("usrid")==todo.getAttribute("usrid")){
                        $("#sidebar").hide();
                    }
                    todo.remove();
                }
                if (item.className === "fa fa-close") {
                    const todo = item.parentElement.parentElement;
                    $.post("delete",{
                        "usrid":todo.getAttribute("usrid"),
                        "taskid":todo.getAttribute("taskid")
                    });
                    if($("#sidebar").attr("taskid")==todo.getAttribute("taskid")&&$("#sidebar").attr("usrid")==todo.getAttribute("usrid")){
                        $("#sidebar").hide();
                    }
                    todo.remove();
                }
            });
            sideBar();
            function checkBox() {
                $("input[type='checkbox']").click(function () {
                    $.post("complete",{
                        "usrid":$(this).parent().attr("usrid"),
                        "taskid":$(this).parent().attr("taskid")
                    });
                    if($("#sidebar").attr("taskid")==$(this).parent().attr("taskid")&&$("#sidebar").attr("usrid")==$(this).parent().attr("usrid")){
                        $("#sidebar").hide();
                    }
                    $(this).parent().remove();
                });
            }
            checkBox();
        }
    </script>
    <script>
        $(document).ready(function() {
            var trigger = $('.hamburger'),
                overlay = $('.overlay'),
                isClosed = false;
            trigger.click(function() {
                hamburger_cross();
            });
            function hamburger_cross() {
                if (isClosed == true) {
                    overlay.hide();
                    trigger.removeClass('is-open');
                    trigger.addClass('is-closed');
                    isClosed = false;
                } else {
                    overlay.show();
                    trigger.removeClass('is-closed');
                    trigger.addClass('is-open');
                    isClosed = true;
                }
            }
            $('[data-toggle="offcanvas"]').click(function() {
                $('#wrapper').toggleClass('toggled');
            });
        });
    </script>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-9" style="background-color: #FFF587">
            <h1 class="h1">To do</h1>
        </div>
        <div class="col-md-3" style="background-color: #FF8C64">
            <nav class="navbar navbar-default navbar-toggler" role="navigation" style="background-color: #FF8C64;border: #FF8C64;
        margin: 10px 10px 10px 10px" >
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#">Nav</a>
                    </div>
                    <div>
                        <ul class="nav navbar-nav">
                            <li><a href="#">Set</a></li>
                            <li><a th:href="help">Help</a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    Sign in
                                    <b class="caret"></b>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="#">My profile</a></li>
                                    <li><a th:href="admin">Sign in</a></li>
                                    <li><a th:href="logout">Sign out</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">分离的链接</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">另一个分离的链接</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col-md-9" style="padding:0 0 0 0;background-color: #A3A1A8;height: 90vh">
            <div class="col-md-9 column leftSide">
                <h2>Tasks</h2>
                <input type="text" placeholder="Add your task here" id="data-new-list-input" style="border: 0 none;outline: none;border-bottom: 1px solid mediumpurple;" >
                <button class="btn" style="background-color:mediumpurple;color: white" id="data-new-list-btn">ADD TASKS</button>
                <ul id="task" >
                </ul>
            </div>
            <div class="col-md-3" style="margin-right:0; float:right;background-color: #F5F5F5;height: 90vh" id="sidebar">
                <div style="border: solid #EAEAEA;margin: 1vh 1vh 1vh 1vh;background-color: #FFFFFF" id="task-content">
                    <p style="font-size: 28px;padding-left: 2vh;padding-bottom: 1vh" > <i class="fa fa-heart-o" style="color:mediumpurple;font-size:30px" id="is-important"></i><span id="sidebar-text">Test</span>

                    </p>
                </div>
                <div class="form-group" style="border: solid #EAEAEA;margin: 1vh 1vh 1vh 1vh;background-color: #FFFFFF" id="calender">
                    <label>选择截止时间：</label>
                    <div class='input-group date' id='datetimepicker2'>
                        <input type='text' class="form-control" id="dateText"/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar" ></span>
                </span>
                        <button class="btn btn-default" style="margin-bottom: 24px" id="setAlert">提交</button>
                </div>
                </div>
                <div style="border: solid #EAEAEA;margin: 1vh 1vh 1vh 1vh;background-color: #FFFFFF" >
                    <p style="font-size: 20px;padding-left: 2vh;padding-bottom: 1vh" ><i class="fa fa-calendar-minus-o" style="color:mediumpurple;font-size:25px" id="is-daily"></i>
                        设为每日事项
                    </p>

                </div>

            </div>
        </div>
        <div class="col-md-3" style="background-color: #FF665A;height: 90vh;padding-top: 2vh">
            <nav class="navbar navbar-inverse navbar-fixed-right" id="sidebar-wrapper"
                 role="navigation" style="background-color: #FF8C64" >
                <ul class="nav sidebar-nav">
                    <li class="sidebar-brand"> <a href="#"> Menu </a> </li>
                    <li> <a href="#"> <i class="fa fa-fw fa-home"> </i> Home </a> </li>
                    <li> <a href="#"> <i class="fa fa-fw fa-folder"> </i> Things </a> </li>
                    <li> <a href="#"> <i class="fa fa-fw fa-file-o"> </i> Important </a> </li>
                    <li> <a href="#"> <i class="fa fa-fw fa-cog"> </i> Calender </a> </li>
                    <!--                <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown"> <i class="fa fa-fw fa-plus"> </i> Dropdown <span class="caret"> </span> </a>-->
                    <!--                    <ul class="dropdown-menu" role="menu">-->
                    <!--                        <li class="dropdown-header"> Dropdown heading </li>-->
                    <!--                        <li> <a href="#"> Action </a> </li>-->
                    <!--                        <li> <a href="#"> Another action </a> </li>-->
                    <!--                        <li> <a href="#"> Something else here </a> </li>-->
                    <!--                        <li> <a href="#"> Separated link </a> </li>-->
                    <!--                        <li> <a href="#"> One more separated link </a> </li>-->
                    <!--                    </ul>-->
                    <!--                </li>-->
                    <!--                <li> <a href="#"> <i class="fa fa-fw fa-bank"> </i> Page four </a> </li>-->
                    <!--                <li> <a href="#"> <i class="fa fa-fw fa-dropbox"> </i> Page 5 </a> </li>-->
                    <!--                <li> <a href="#"> <i class="fa fa-fw fa-twitter"> </i> Last page </a> </li>-->
                </ul>
            </nav>


        </div>
    </div>
</div>
</body>
</html>